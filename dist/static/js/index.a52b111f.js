(function(t){function e(e){for(var i,a,n=e[0],l=e[1],h=e[2],d=0,b=[];d<n.length;d++)a=n[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&b.push(r[a][0]),r[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);c&&c(e);while(b.length)b.shift()();return s.push.apply(s,h||[]),o()}function o(){for(var t,e=0;e<s.length;e++){for(var o=s[e],i=!0,n=1;n<o.length;n++){var l=o[n];0!==r[l]&&(i=!1)}i&&(s.splice(e--,1),t=a(a.s=o[0]))}return t}var i={},r={index:0},s=[];function a(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=i,a.d=function(t,e,o){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(o,i,function(e){return t[e]}.bind(null,i));return o},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=e,n=n.slice();for(var h=0;h<n.length;h++)e(n[h]);var c=l;s.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("c31f")},1:function(t,e){},2:function(t,e){},3:function(t,e){},"4d1c":function(t,e,o){"use strict";var i=o("5b12"),r=o.n(i);r.a},"5b12":function(t,e,o){},b9d9:function(t,e,o){},c31f:function(t,e,o){"use strict";o.r(e);var i=o("2b0e"),r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"fabric-sketchpad"}},[o("router-view")],1)},s=[],a=(o("4d1c"),o("2877")),n={},l=Object(a["a"])(n,r,s,!1,null,null,null),h=l.exports,c=o("8c4f"),d=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("vue-fabric-sketchpad")},b=[],u={name:"home",components:{}},p=u,m=Object(a["a"])(p,d,b,!1,null,null,null),f=m.exports;i["a"].use(c["a"]);var g=new c["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:f}]}),y=o("2f62");i["a"].use(y["a"]);var w=new y["a"].Store({state:{},mutations:{},actions:{}}),j=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"board-box",style:{width:t.canvasWidth+"px",height:t.canvasHeight+"px"}},[o("input",{ref:"sketchpadUpload",attrs:{type:"file",accept:"image/*",id:"sketchpad-upload"},on:{change:function(e){return t.uploadImg(e)}}}),o("ul",{staticClass:"tool-box",class:{"tool-box--left":"left"===t.placement,"tool-box--top":"top"===t.placement,"tool-box--right":"right"===t.placement,"tool-box--bottom":"bottom"===t.placement}},t._l(t.tools,(function(e){return o("li",{key:e.type,staticClass:"tool-con",class:{active:t.toolType===e.type},on:{click:function(o){return t.changeTool(e.type)}}},["upload"===e.type?o("label",{attrs:{for:"sketchpad-upload"}},[o("i",{staticClass:"iconfont",class:e.icon})]):o("i",{staticClass:"iconfont",class:e.icon})])})),0),o("canvas",{ref:"myCanvas",style:{"background-color":t.canvasBgColor},attrs:{id:"myCanvas"}})])},O=[],x=o("7a94"),v=o("21a6"),k=o.n(v);o("b9d9");console.log("fabric",x["fabric"]);let T={canvasWidth:{type:Number,default:window.innerWidth},canvasHeight:{type:Number,default:window.innerHeight},canvasBgColor:{type:String,default:"#f6f6f6"},strokeColor:{type:String,default:"#f30"},strokeWidth:{type:Number,default:2},showTools:{type:Boolean,default:!0},placement:{type:String,default:"left"}};const M=[{name:"铅笔",type:"pencil",icon:"icon-pan_icon"},{name:"实线",type:"line",icon:"icon-xian"},{name:"虚线",type:"dashedLine",icon:"icon-xian1"},{name:"箭头",type:"arrow",icon:"icon-jiantou"},{name:"文字",type:"text",icon:"icon-wenzi"},{name:"矩形",type:"rect",icon:"icon-juxing"},{name:"圆形",type:"cricle",icon:"icon-yuanxing"},{name:"椭圆形",type:"ellipse",icon:"icon-tuoyuanxing"},{name:"三角形",type:"equilateral",icon:"icon-sanjiaoxing"},{name:"上传图片",type:"upload",icon:"icon-seiyw41"},{name:"橡皮",type:"rubber",icon:"icon-xiangpi"},{name:"回退",type:"undo",icon:"icon-undo"},{name:"向前",type:"redo",icon:"icon-redo"},{name:"清除",type:"clear",icon:"icon-clear"},{name:"移动",type:"move",icon:"icon-yidong"},{name:"下载",type:"download",icon:"icon-xiazai"}];var F={name:"vue-fabric-sketchpad",data(){return{boardObj:null,mouseFrom:{},mouseTo:{},toolType:"pencil",isDrawing:!1,drawingObj:null,history:[],textObj:null,stage:0,currImg:"",tools:M}},props:T,mounted(){this.boardObj=new x["fabric"].Canvas("myCanvas",{isDrawingMode:!0,selectable:!0,selection:!0,devicePixelRatio:!0}),this.boardObj.freeDrawingBrush.color=this.strokeColor,this.boardObj.freeDrawingBrush.width=this.strokeWidth,this.boardObj.setWidth(this.canvasWidth),this.boardObj.setHeight(this.canvasHeight),this.initEvent()},methods:{initEvent(){this.boardObj.on({"mouse:down":t=>{console.log("down",t);let{x:e,y:o}=t.pointer;this.mouseFrom={x:e,y:o},this.boardObj.getActiveObject()||(this.isDrawing=!0),"text"===this.toolType&&this.drawText()},"mouse:up":t=>{console.log("up",t);let{x:e,y:o}=t.pointer;this.mouseTo={x:e,y:o},this.isDrawing=!1,this.drawingObj=null,this.addHistory()},"mouse:move":t=>{if(this.isDrawing){console.log("move",t);let{x:e,y:o}=t.pointer;this.mouseTo={x:e,y:o},this.drawing()}},"object:moving":t=>{console.log("移动",t)},"object:scaling":t=>{console.log("放大缩小",t)},"object:rotating":t=>{console.log("旋转",t)},"selection:created":t=>{if(console.log("选中了"),"rubber"===this.toolType){if(t.target._objects)for(var e=t.target._objects.length,o=0;o<e;o++)this.boardObj.remove(t.target._objects[o]);else this.boardObj.remove(t.target);this.boardObj.discardActiveObject()}this.addHistory()}})},drawing(){this.drawingObj&&this.boardObj.remove(this.drawingObj),this.boardObj.isDrawingMode=!1,this.boardObj.selectable=!1,this.boardObj.selection=!1;let t=null;switch(this.toolType){case"pencil":this.boardObj.isDrawingMode=!0;break;case"line":t=this.drawLine();break;case"dashedLine":t=this.drawDashedLine();break;case"arrow":t=this.drawArrow();break;case"rect":t=this.drawRect();break;case"cricle":t=this.drawCricle();break;case"ellipse":t=this.drawEllipse();break;case"equilateral":t=this.drawEquilateral();break;default:t=null,this.boardObj.selection=!0,this.boardObj.skipTargetFind=!1,this.boardObj.selectable=!0;break}t&&(console.log(t),this.boardObj.add(t),this.drawingObj=t)},changeTool(t){if(this.boardObj.isDrawingMode=!1,this.resetDrawObj(),this.boardObj.getActiveObject()&&(this.boardObj.discardActiveObject(),this.boardObj.renderAll()),"clear"===t)return this.boardObj.clear();if("upload"!==t){if("undo"===t)return this.undo();if("redo"===t)return this.redo();if("download"===t)return this.composeImg();this.toolType=t,"pencil"===t&&(this.boardObj.isDrawingMode=!0),"rubber"!==t&&"move"!==t||(this.boardObj.selection=!0,this.boardObj.skipTargetFind=!1,this.boardObj.selectable=!0)}},resetDrawObj(){this.boardObj.selectable=!0,this.boardObj.selection=!0,this.boardObj.skipTargetFind=!1,this.textObj&&(this.textObj.exitEditing(),this.textObj=null)},drawLine(){return new x["fabric"].Line([this.mouseFrom.x,this.mouseFrom.y,this.mouseTo.x,this.mouseTo.y],{stroke:this.strokeColor,strokeWidth:this.strokeWidth})},drawDashedLine(){return new x["fabric"].Line([this.mouseFrom.x,this.mouseFrom.y,this.mouseTo.x,this.mouseTo.y],{stroke:this.strokeColor,strokeWidth:this.strokeWidth,strokeDashArray:[10,3]})},drawRect(){return new x["fabric"].Rect({left:this.mouseFrom.x,top:this.mouseFrom.y,height:Math.abs(this.mouseTo.y-this.mouseFrom.y),width:Math.abs(this.mouseTo.x-this.mouseFrom.x),stroke:this.strokeColor,strokeWidth:this.strokeWidth,fill:"rgba(255, 255, 255, 0)"})},drawCricle(){let t=this.mouseTo.x-this.mouseFrom.x,e=this.mouseTo.y-this.mouseFrom.y,o=Math.sqrt(Math.pow(t,2)+Math.pow(e,2))/2;return new x["fabric"].Circle({left:this.mouseFrom.x,top:this.mouseFrom.y,stroke:this.strokeColor,fill:"rgba(255, 255, 255, 0)",radius:o,strokeWidth:this.strokeWidth})},drawEllipse(){let t=this.mouseFrom.x,e=this.mouseFrom.y;return new x["fabric"].Ellipse({left:t,top:e,stroke:this.strokeColor,fill:"rgba(255, 255, 255, 0)",originX:"center",originY:"center",rx:Math.abs(t-this.mouseTo.x),ry:Math.abs(e-this.mouseTo.y),strokeWidth:this.strokeWidth})},drawEquilateral(){let t=this.mouseTo.y-this.mouseFrom.y;return new x["fabric"].Triangle({top:this.mouseFrom.y,left:this.mouseFrom.x,width:Math.sqrt(Math.pow(t,2)+Math.pow(t/2,2)),height:t,stroke:this.strokeColor,strokeWidth:this.strokeWidth,fill:"rgba(255,255,255,0)"})},drawArrow(){let[t,e]=[this.mouseFrom.x,this.mouseFrom.y],[o,i]=[this.mouseTo.x,this.mouseTo.y],r=e-i,s=t-o,a=30,n=30;var l=180*Math.atan2(r,s)/Math.PI,h=(l+a)*Math.PI/180,c=(l-a)*Math.PI/180,d=n*Math.cos(h),b=n*Math.sin(h),u=n*Math.cos(c),p=n*Math.sin(c),m=t-d,f=e-b,g=" M "+t+" "+e;return g+=" L "+o+" "+i,m=o+d,f=i+b,g+=" M "+m+" "+f,g+=" L "+o+" "+i,m=o+u,f=i+p,g+=" L "+m+" "+f,new x["fabric"].Path(g,{stroke:this.strokeColor,fill:"rgba(255,255,255,0)",strokeWidth:this.strokeWidth})},drawText(){let{x:t,y:e}=this.mouseFrom;this.textObj=new x["fabric"].Textbox("",{left:t,top:e,width:"",height:"",fill:this.strokeColor,hasControls:!0}),this.boardObj.add(this.textObj),this.textObj.enterEditing(),this.textObj.hiddenTextarea.focus(),this.addHistory()},addHistory(){this.history.push(JSON.stringify(this.boardObj))},undo(){let t=this.history;this.stage<t.length&&(this.boardObj.clear().renderAll(),this.boardObj.loadFromJSON(t[t.length-1-this.stage-1]),this.boardObj.renderAll(),this.stage+=1)},redo(){let t=this.history;this.stage>0&&(this.boardObj.clear().renderAll(),this.boardObj.loadFromJSON(t[t.length-1-this.stage+1]),this.boardObj.renderAll(),this.stage-=1)},composeImg(){let t=this.boardObj.toDataURL({formart:"png",multiplier:2}),e=t.split(","),o=e[0].match(/:(.*?);/)[1],i=atob(e[1]),r=i.length,s=new Uint8Array(r);while(r--)s[r]=i.charCodeAt(r);let a=new Blob([s],{type:o});console.log("blob",a),k.a.saveAs(a,"sketchpad.png")},uploadImg(t){let e=t.target.files[0],o=new FileReader;o.onload=t=>{let e=t.target.result,o=new Image;o.src=e,o.onload=()=>{console.log("imgObj",o);var t=new x["fabric"].Image(o);t.scale(.5),this.boardObj.centerObject(t).add(t).renderAll(),this.$refs.sketchpadUpload.value=""}},o.readAsDataURL(e)}}},C=F,W=Object(a["a"])(C,j,O,!1,null,null,null),D=W.exports;D.install=function(t){t.component(D.name,D)};var A=D;o("f327");i["a"].use(A),i["a"].config.productionTip=!1,new i["a"]({router:g,store:w,render:t=>t(h)}).$mount("#vue-fabric-sketchpad")},f327:function(t,e,o){}});
//# sourceMappingURL=index.a52b111f.js.map